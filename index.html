<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›½é™…éŸ³æ ‡å­¦ä¹ å¡ç‰‡</title>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=yM4ApGw0"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #5a67d8;
            text-align: center;
        }
        .phonetic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        .phonetic-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .phonetic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            background: #edf2f7;
        }
        .symbol {
            font-size: 28px;
            color: #2d3748;
            margin-bottom: 10px;
        }
        .example {
            font-size: 14px;
            color: #718096;
        }
        .category {
            margin-top: 30px;
        }
        .category-title {
            color: #4a5568;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        #practice-area {
            margin-top: 30px;
            padding: 20px;
            background: #f0fff4;
            border-radius: 10px;
            text-align: center;
        }
        button {
            background: #48bb78;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #38a169;
        }
    </style>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=yM4ApGw0"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸµ å›½é™…éŸ³æ ‡å­¦ä¹ å¡ç‰‡ ğŸµ</h1>
        <div style="text-align: center; margin-bottom: 20px; color: #718096;">
            <strong>æ€»è®¡44ä¸ªéŸ³æ ‡</strong> = 12ä¸ªå•å…ƒéŸ³ + 8ä¸ªåŒå…ƒéŸ³ + 24ä¸ªè¾…éŸ³
        </div>
        
        <div class="category">
            <div class="category-title">å•å…ƒéŸ³ (Monophthongs) - 12ä¸ª</div>
            <div class="phonetic-grid" id="vowels"></div>
        </div>

        <div class="category">
            <div class="category-title">åŒå…ƒéŸ³ (Diphthongs) - 8ä¸ª</div>
            <div class="phonetic-grid" id="diphthongs"></div>
        </div>

        <div class="category">
            <div class="category-title">è¾…éŸ³ (Consonants) - 24ä¸ª</div>
            <div class="phonetic-grid" id="consonants"></div>
        </div>

        <div id="practice-area">
            <h2>ç»ƒä¹ åŒº</h2>
            <div id="question" style="font-size: 48px; margin: 20px;">?</div>
            <button onclick="startPractice()">å¼€å§‹ç»ƒä¹ </button>
            <button onclick="checkAnswer()">æ˜¾ç¤ºç­”æ¡ˆ</button>
            <div id="answer" style="margin-top: 20px; font-size: 18px;"></div>
        </div>
    </div>

    <script>
        // è¯åº“å’ŒçŠ¶æ€ç®¡ç†
        let wordsData = {};
        let cardClickCount = {};
        let currentSymbol = null;

        // éŸ³æ ‡åˆ†ç±»
        const vowels = ['iË', 'Éª', 'e', 'Ã¦', 'É‘Ë', 'É’', 'É”Ë', 'ÊŠ', 'uË', 'ÊŒ', 'ÉœË', 'É™'];
        const diphthongs = ['eÉª', 'aÉª', 'É”Éª', 'aÊŠ', 'É™ÊŠ', 'ÉªÉ™', 'eÉ™', 'ÊŠÉ™'];
        const consonants = ['p', 'b', 't', 'd', 'k', 'g', 'tÊƒ', 'dÊ’', 'f', 'v', 'Î¸', 'Ã°', 's', 'z', 'Êƒ', 'Ê’', 'h', 'm', 'n', 'Å‹', 'l', 'r', 'w', 'j'];

        // å¼‚æ­¥åŠ è½½è¯åº“
        fetch('words.json')
            .then(response => response.json())
            .then(data => {
                wordsData = data;
                // åˆå§‹åŒ–ç‚¹å‡»è®¡æ•°
                Object.keys(wordsData).forEach(key => {
                    cardClickCount[key] = 0;
                });
                // åˆ›å»ºæ‰€æœ‰å¡ç‰‡
                createCards(vowels, 'vowels');
                createCards(diphthongs, 'diphthongs');
                createCards(consonants, 'consonants');
            })
            .catch(error => {
                console.error('åŠ è½½è¯åº“å¤±è´¥:', error);
                // ä½¿ç”¨é™çº§æ–¹æ¡ˆ
                initializeFallback();
            });

        // åˆ›å»ºå¡ç‰‡å‡½æ•°
        function createCards(symbols, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            symbols.forEach(symbol => {
                const card = document.createElement('div');
                card.className = 'phonetic-card';
                
                // è·å–å½“å‰æ˜¾ç¤ºçš„å•è¯
                const currentWord = getCurrentWord(symbol);
                
                card.innerHTML = `
                    <div class="symbol">${symbol}</div>
                    <div class="example">${currentWord}</div>
                `;
                
                card.onclick = () => handleCardClick(symbol, symbols, containerId);
                container.appendChild(card);
            });
        }

        // è·å–å½“å‰æ˜¾ç¤ºçš„å•è¯
        function getCurrentWord(symbol) {
            if (!wordsData[symbol] || wordsData[symbol].length === 0) return symbol;
            const wordIndex = Math.floor(cardClickCount[symbol] / 3) % wordsData[symbol].length;
            return wordsData[symbol][wordIndex];
        }

        // è·å–æœ€ä½³è‹±è¯­è¯­éŸ³
        function getBestEnglishVoice() {
            if (typeof responsiveVoice === 'undefined' || !responsiveVoice.getVoices) {
                return null; // ä½¿ç”¨é»˜è®¤è¯­éŸ³
            }
            
            const voices = responsiveVoice.getVoices();
            
            // ä¼˜å…ˆçº§åˆ—è¡¨
            const priorities = [
                'UK English Female',
                'British English Female', 
                'UK English Male',
                'British English Male',
                'US English Female',
                'English Female'
            ];
            
            for (let priority of priorities) {
                const found = voices.find(voice => voice.name === priority);
                if (found) {
                    return found.name;
                }
            }
            
            // é™çº§ï¼šæ‰¾ä»»ä½•åŒ…å«Englishçš„è¯­éŸ³
            const englishVoice = voices.find(voice => 
                voice.name.toLowerCase().includes('english')
            );
            
            return englishVoice ? englishVoice.name : null;
        }

        // å¤„ç†å¡ç‰‡ç‚¹å‡»
        function handleCardClick(symbol, symbols, containerId) {
            // å¢åŠ ç‚¹å‡»è®¡æ•°
            cardClickCount[symbol]++;
            const currentWord = getCurrentWord(symbol);
            
            // å‘éŸ³ï¼šå…ˆè¯»éŸ³æ ‡ç¤ºä¾‹ï¼Œå†è¯»å•è¯
            if (typeof responsiveVoice !== 'undefined') {
                try {
                    const phonemeExample = getPhonemeExample(symbol);
                    const voiceName = getBestEnglishVoice();
                    
                    responsiveVoice.speak(phonemeExample, voiceName, {
                        rate: 0.6,
                        onend: function() {
                            responsiveVoice.speak(currentWord, voiceName, {
                                rate: 0.8
                            });
                        }
                    });
                } catch(error) {
                    console.error('è¯­éŸ³æ’­æ”¾é”™è¯¯:', error);
                    // é™çº§åˆ°åªæ’­æ”¾å•è¯
                    const voiceName = getBestEnglishVoice();
                    if (voiceName) {
                        responsiveVoice.speak(currentWord, voiceName, {rate: 0.8});
                    } else {
                        speak(currentWord);
                    }
                }
            } else {
                // ä½¿ç”¨æµè§ˆå™¨TTSé™çº§
                speak(currentWord);
            }
            
            // æ¯ç‚¹å‡»3æ¬¡åˆ‡æ¢å•è¯
            if (cardClickCount[symbol] % 3 === 0) {
                setTimeout(() => {
                    createCards(symbols, containerId);
                }, 100);
            }
        }

        // è·å–éŸ³æ ‡çš„å‘éŸ³ç¤ºä¾‹ï¼ˆç”¨ç®€å•çš„å•è¯æ¥ç¤ºèŒƒéŸ³æ ‡å‘éŸ³ï¼‰
        function getPhonemeExample(symbol) {
            const examples = {
                // å•å…ƒéŸ³
                'iË': 'ee',    // seeçš„éŸ³
                'Éª': 'ih',     // sitçš„éŸ³  
                'e': 'eh',     // bedçš„éŸ³
                'Ã¦': 'ah',     // catçš„éŸ³
                'É‘Ë': 'ar',    // carçš„éŸ³
                'É’': 'oh',     // hotçš„éŸ³
                'É”Ë': 'aw',    // sawçš„éŸ³
                'ÊŠ': 'uh',     // putçš„éŸ³
                'uË': 'oo',    // tooçš„éŸ³
                'ÊŒ': 'uh',     // cupçš„éŸ³
                'ÉœË': 'er',    // birdçš„éŸ³
                'É™': 'uh',     // aboutçš„éŸ³
                
                // åŒå…ƒéŸ³
                'eÉª': 'ay',    // dayçš„éŸ³
                'aÉª': 'eye',   // myçš„éŸ³
                'É”Éª': 'oy',    // boyçš„éŸ³
                'aÊŠ': 'ow',    // nowçš„éŸ³
                'É™ÊŠ': 'oh',    // goçš„éŸ³
                'ÉªÉ™': 'ear',   // hereçš„éŸ³
                'eÉ™': 'air',   // whereçš„éŸ³
                'ÊŠÉ™': 'oor',   // tourçš„éŸ³
                
                // è¾…éŸ³
                'p': 'puh', 'b': 'buh', 't': 'tuh', 'd': 'duh',
                'k': 'kuh', 'g': 'guh', 'f': 'fuh', 'v': 'vuh',
                'Î¸': 'th', 'Ã°': 'th', 's': 'sss', 'z': 'zzz',
                'Êƒ': 'sh', 'Ê’': 'zh', 'h': 'huh', 'm': 'mmm',
                'n': 'nnn', 'Å‹': 'ng', 'l': 'lll', 'r': 'rrr',
                'w': 'wuh', 'j': 'yuh', 'tÊƒ': 'ch', 'dÊ’': 'juh'
            };
            
            return examples[symbol] || symbol;
        }

        // é™çº§TTSå‡½æ•°
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }

        // ç»ƒä¹ åŠŸèƒ½
        function startPractice() {
            if (Object.keys(wordsData).length === 0) {
                alert('è¯åº“è¿˜åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨ç­‰...');
                return;
            }
            
            const allSymbols = [...vowels, ...diphthongs, ...consonants];
            currentSymbol = allSymbols[Math.floor(Math.random() * allSymbols.length)];
            const currentWord = getCurrentWord(currentSymbol);
            
            // æ˜¾ç¤ºå•è¯çš„éŸ³æ ‡å½¢å¼
            document.getElementById('question').textContent = getWordPhonetics(currentWord);
            document.getElementById('answer').textContent = '';
        }

        function checkAnswer() {
            if (!currentSymbol) return;
            
            const currentWord = getCurrentWord(currentSymbol);
            document.getElementById('answer').textContent = `ç­”æ¡ˆ: ${currentWord}`;
            
            // å‘éŸ³
            if (typeof responsiveVoice !== 'undefined') {
                const voiceName = getBestEnglishVoice();
                responsiveVoice.speak(currentSymbol, voiceName, {
                    rate: 0.8,
                    onend: function() {
                        responsiveVoice.speak(currentWord, voiceName, {rate: 0.8});
                    }
                });
            } else {
                speak(currentWord);
            }
        }

        // è·å–å•è¯çš„éŸ³æ ‡å½¢å¼ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function getWordPhonetics(word) {
            const phoneticMap = {
                'like': 'laÉªk', 'life': 'laÉªf', 'time': 'taÉªm',
                'day': 'deÉª', 'play': 'pleÉª', 'make': 'meÉªk',
                'see': 'siË', 'need': 'niËd', 'keep': 'kiËp',
                'sit': 'sÉªt', 'big': 'bÉªÉ¡', 'fish': 'fÉªÊƒ'
            };
            return phoneticMap[word] || word;
        }

        // é™çº§åˆå§‹åŒ–
        function initializeFallback() {
            console.log('ä½¿ç”¨é™çº§æ–¹æ¡ˆåˆå§‹åŒ–');
            wordsData = {
                'aÉª': ['like', 'life', 'time'],
                'eÉª': ['day', 'play', 'make'],
                'iË': ['see', 'need', 'keep']
                // æ·»åŠ æ›´å¤š...
            };
            Object.keys(wordsData).forEach(key => {
                cardClickCount[key] = 0;
            });
            createCards(['aÉª', 'eÉª', 'iË'], 'vowels');
        }

        // ç­‰å¾…ResponsiveVoiceåŠ è½½
        function waitForResponsiveVoice() {
            if (typeof responsiveVoice !== 'undefined') {
                console.log('ResponsiveVoiceå·²åŠ è½½');
            } else {
                setTimeout(waitForResponsiveVoice, 100);
            }
        }
        waitForResponsiveVoice();
    </script>
</body>
</html>