<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>国际音标学习卡片</title>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=yM4ApGw0"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #5a67d8;
            text-align: center;
        }
        .phonetic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        .phonetic-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .phonetic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            background: #edf2f7;
        }
        .symbol {
            font-size: 28px;
            color: #2d3748;
            margin-bottom: 10px;
        }
        .example {
            font-size: 14px;
            color: #718096;
        }
        .category {
            margin-top: 30px;
        }
        .category-title {
            color: #4a5568;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        #practice-area {
            margin-top: 30px;
            padding: 20px;
            background: #f0fff4;
            border-radius: 10px;
            text-align: center;
        }
        button {
            background: #48bb78;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #38a169;
        }
    </style>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=yM4ApGw0"></script>
</head>
<body>
    <div class="container">
        <h1>🎵 国际音标学习卡片 🎵</h1>
        <div style="text-align: center; margin-bottom: 20px; color: #718096;">
            <strong>总计44个音标</strong> = 12个单元音 + 8个双元音 + 24个辅音
        </div>
        
        <div class="category">
            <div class="category-title">单元音 (Monophthongs) - 12个</div>
            <div class="phonetic-grid" id="vowels"></div>
        </div>

        <div class="category">
            <div class="category-title">双元音 (Diphthongs) - 8个</div>
            <div class="phonetic-grid" id="diphthongs"></div>
        </div>

        <div class="category">
            <div class="category-title">辅音 (Consonants) - 24个</div>
            <div class="phonetic-grid" id="consonants"></div>
        </div>

        <div id="practice-area">
            <h2>练习区</h2>
            <div id="question" style="font-size: 48px; margin: 20px;">?</div>
            <button onclick="startPractice()">开始练习</button>
            <button onclick="checkAnswer()">显示答案</button>
            <div id="answer" style="margin-top: 20px; font-size: 18px;"></div>
        </div>
    </div>

    <script>
        // 词库和状态管理
        let wordsData = {};
        let cardClickCount = {};
        let currentSymbol = null;

        // 音标分类
        const vowels = ['iː', 'ɪ', 'e', 'æ', 'ɑː', 'ɒ', 'ɔː', 'ʊ', 'uː', 'ʌ', 'ɜː', 'ə'];
        const diphthongs = ['eɪ', 'aɪ', 'ɔɪ', 'aʊ', 'əʊ', 'ɪə', 'eə', 'ʊə'];
        const consonants = ['p', 'b', 't', 'd', 'k', 'g', 'tʃ', 'dʒ', 'f', 'v', 'θ', 'ð', 's', 'z', 'ʃ', 'ʒ', 'h', 'm', 'n', 'ŋ', 'l', 'r', 'w', 'j'];

        // 异步加载词库
        fetch('words.json')
            .then(response => response.json())
            .then(data => {
                wordsData = data;
                // 初始化点击计数
                Object.keys(wordsData).forEach(key => {
                    cardClickCount[key] = 0;
                });
                // 创建所有卡片
                createCards(vowels, 'vowels');
                createCards(diphthongs, 'diphthongs');
                createCards(consonants, 'consonants');
            })
            .catch(error => {
                console.error('加载词库失败:', error);
                // 使用降级方案
                initializeFallback();
            });

        // 创建卡片函数
        function createCards(symbols, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            symbols.forEach(symbol => {
                const card = document.createElement('div');
                card.className = 'phonetic-card';
                
                // 获取当前显示的单词
                const currentWord = getCurrentWord(symbol);
                
                card.innerHTML = `
                    <div class="symbol">${symbol}</div>
                    <div class="example">${currentWord}</div>
                `;
                
                card.onclick = () => handleCardClick(symbol, symbols, containerId);
                container.appendChild(card);
            });
        }

        // 获取当前显示的单词
        function getCurrentWord(symbol) {
            if (!wordsData[symbol] || wordsData[symbol].length === 0) return symbol;
            const wordIndex = Math.floor(cardClickCount[symbol] / 3) % wordsData[symbol].length;
            return wordsData[symbol][wordIndex];
        }

        // 获取最佳英语语音
        function getBestEnglishVoice() {
            if (typeof responsiveVoice === 'undefined' || !responsiveVoice.getVoices) {
                return null; // 使用默认语音
            }
            
            const voices = responsiveVoice.getVoices();
            
            // 优先级列表
            const priorities = [
                'UK English Female',
                'British English Female', 
                'UK English Male',
                'British English Male',
                'US English Female',
                'English Female'
            ];
            
            for (let priority of priorities) {
                const found = voices.find(voice => voice.name === priority);
                if (found) {
                    return found.name;
                }
            }
            
            // 降级：找任何包含English的语音
            const englishVoice = voices.find(voice => 
                voice.name.toLowerCase().includes('english')
            );
            
            return englishVoice ? englishVoice.name : null;
        }

        // 处理卡片点击
        function handleCardClick(symbol, symbols, containerId) {
            // 增加点击计数
            cardClickCount[symbol]++;
            const currentWord = getCurrentWord(symbol);
            
            // 发音：先读音标示例，再读单词
            if (typeof responsiveVoice !== 'undefined') {
                try {
                    const phonemeExample = getPhonemeExample(symbol);
                    const voiceName = getBestEnglishVoice();
                    
                    responsiveVoice.speak(phonemeExample, voiceName, {
                        rate: 0.6,
                        onend: function() {
                            responsiveVoice.speak(currentWord, voiceName, {
                                rate: 0.8
                            });
                        }
                    });
                } catch(error) {
                    console.error('语音播放错误:', error);
                    // 降级到只播放单词
                    const voiceName = getBestEnglishVoice();
                    if (voiceName) {
                        responsiveVoice.speak(currentWord, voiceName, {rate: 0.8});
                    } else {
                        speak(currentWord);
                    }
                }
            } else {
                // 使用浏览器TTS降级
                speak(currentWord);
            }
            
            // 每点击3次切换单词
            if (cardClickCount[symbol] % 3 === 0) {
                setTimeout(() => {
                    createCards(symbols, containerId);
                }, 100);
            }
        }

        // 获取音标的发音示例（用简单的单词来示范音标发音）
        function getPhonemeExample(symbol) {
            const examples = {
                // 单元音
                'iː': 'ee',    // see的音
                'ɪ': 'ih',     // sit的音  
                'e': 'eh',     // bed的音
                'æ': 'ah',     // cat的音
                'ɑː': 'ar',    // car的音
                'ɒ': 'oh',     // hot的音
                'ɔː': 'aw',    // saw的音
                'ʊ': 'uh',     // put的音
                'uː': 'oo',    // too的音
                'ʌ': 'uh',     // cup的音
                'ɜː': 'er',    // bird的音
                'ə': 'uh',     // about的音
                
                // 双元音
                'eɪ': 'ay',    // day的音
                'aɪ': 'eye',   // my的音
                'ɔɪ': 'oy',    // boy的音
                'aʊ': 'ow',    // now的音
                'əʊ': 'oh',    // go的音
                'ɪə': 'ear',   // here的音
                'eə': 'air',   // where的音
                'ʊə': 'oor',   // tour的音
                
                // 辅音
                'p': 'puh', 'b': 'buh', 't': 'tuh', 'd': 'duh',
                'k': 'kuh', 'g': 'guh', 'f': 'fuh', 'v': 'vuh',
                'θ': 'th', 'ð': 'th', 's': 'sss', 'z': 'zzz',
                'ʃ': 'sh', 'ʒ': 'zh', 'h': 'huh', 'm': 'mmm',
                'n': 'nnn', 'ŋ': 'ng', 'l': 'lll', 'r': 'rrr',
                'w': 'wuh', 'j': 'yuh', 'tʃ': 'ch', 'dʒ': 'juh'
            };
            
            return examples[symbol] || symbol;
        }

        // 降级TTS函数
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }

        // 练习功能
        function startPractice() {
            if (Object.keys(wordsData).length === 0) {
                alert('词库还在加载中，请稍等...');
                return;
            }
            
            const allSymbols = [...vowels, ...diphthongs, ...consonants];
            currentSymbol = allSymbols[Math.floor(Math.random() * allSymbols.length)];
            const currentWord = getCurrentWord(currentSymbol);
            
            // 显示单词的音标形式
            document.getElementById('question').textContent = getWordPhonetics(currentWord);
            document.getElementById('answer').textContent = '';
        }

        function checkAnswer() {
            if (!currentSymbol) return;
            
            const currentWord = getCurrentWord(currentSymbol);
            document.getElementById('answer').textContent = `答案: ${currentWord}`;
            
            // 发音
            if (typeof responsiveVoice !== 'undefined') {
                const voiceName = getBestEnglishVoice();
                responsiveVoice.speak(currentSymbol, voiceName, {
                    rate: 0.8,
                    onend: function() {
                        responsiveVoice.speak(currentWord, voiceName, {rate: 0.8});
                    }
                });
            } else {
                speak(currentWord);
            }
        }

        // 获取单词的音标形式（简化版）
        function getWordPhonetics(word) {
            const phoneticMap = {
                'like': 'laɪk', 'life': 'laɪf', 'time': 'taɪm',
                'day': 'deɪ', 'play': 'pleɪ', 'make': 'meɪk',
                'see': 'siː', 'need': 'niːd', 'keep': 'kiːp',
                'sit': 'sɪt', 'big': 'bɪɡ', 'fish': 'fɪʃ'
            };
            return phoneticMap[word] || word;
        }

        // 降级初始化
        function initializeFallback() {
            console.log('使用降级方案初始化');
            wordsData = {
                'aɪ': ['like', 'life', 'time'],
                'eɪ': ['day', 'play', 'make'],
                'iː': ['see', 'need', 'keep']
                // 添加更多...
            };
            Object.keys(wordsData).forEach(key => {
                cardClickCount[key] = 0;
            });
            createCards(['aɪ', 'eɪ', 'iː'], 'vowels');
        }

        // 等待ResponsiveVoice加载
        function waitForResponsiveVoice() {
            if (typeof responsiveVoice !== 'undefined') {
                console.log('ResponsiveVoice已加载');
            } else {
                setTimeout(waitForResponsiveVoice, 100);
            }
        }
        waitForResponsiveVoice();
    </script>
</body>
</html>